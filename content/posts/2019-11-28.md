+++
date = "2019-11-28 08:33:41"
draft = false
title = "Yubikeyを導入してみる 4"
description = "yubicoのサイトでも、WebAuthnのテストができるようだ。yubikeyの動作を試す目的なら、こちらのほうが安全か。"

[taxonomies]
tags = ["yubikey", "Security"]

[extra]
image = "/2019-11-28/73ewT1pIZ0fNwIxak6y8suYe.png"
+++

　yubicoのサイトでも、WebAuthnのテストができるようだ。yubikeyの動作を試す目的なら、こちらのほうが安全か。

> Yubico demo website  
> <https://demo.yubico.com/webauthn-technical/registration>

　Yubico demo websiteを使ってみる。

　アクセスすると以下の画面が表示される。WebAuthnでyubikeyをテストするために、まずデバイス登録を行うと書いてある。

![](/2019-11-28/73ewT1pIZ0fNwIxak6y8suYe.png)

　NEXTボタンを押すと、上部にポップアップが表示されるので続行を押す。

![](/2019-11-28/Hn56pYZfRPPRkWGjrFfEFP0t.png)

　違うポップアップが表示される。この時に、USBコネクタにyubikeyを挿入する。鍵マークが少しチカチカした後に、ゆっくり点滅するので指で押す。

![](/2019-11-28/93CtkD8VXp9wGP42jdHBpkZg.png)

　押すと認証デバイスの登録が完了して、以下の画面になる。

![](/2019-11-28/dj54Dadxzq9yQ9nS12VR8HkU.png)

　下に表示される"Show technical details" を開くと、登録に必要な以下のやりとりで、実際に何が送られているのか詳しく見ることができる。

- Browser to authenticator
- Response from the authenticator
- Response from the Relying Party

　それぞれのステップは、NEXTボタンでステップで進み、PREFボタンで戻ることができる。

![](/2019-11-28/XcneJ9XaefBgoTX3lH9PK7tu.png)

![](/2019-11-28/MXIRMPuuUIBcUhStHbxgOu5Q.png)

![](/2019-11-28/646op4wCI1MN7yy2EWBwn4DO.png)

　さらに、yubikeyに格納された証明書の情報や、PEMファイルをコピーすることもできる。この内容を見ると、内蔵の証明書の有効期限が"2050-09-04"までだということがわかる。

![](/2019-11-28/ZwHSY8Zd3O8TjWVnRsNuIWwW.png)

　登録が終わったので、AUTHENTICATEボタンを押して、実際に認証してみる。  
　認証画面に遷移するので、NEXTボタンを押して認証を開始する。  
　先程と同様のポップアップが出るので、その間にyubikeyの鍵マークを触る。この時間は、3秒程度という目安はあるが、１秒未満で認識された。  

![](/2019-11-28/bpE3H5WS6Scv6eI1h0qB3ACr.png)

　認証に成功すると、この画面に遷移した。

![](/2019-11-28/XrqOImzYHTDC2d7vedyZ5eLW.png)

　このテストでは、デバイスを使った認証のみをテストしているようだ。

　一般的にはサービス利用では多要素認証になるので、ユーザーIDとパスワードを入れた後に、yubikeyを使った認証が行われる。  
　PLAYGROUNDボタンを押すと、yubicoにユーザーを登録して、多要素認証してみることもできる。

![](/2019-11-28/3qECGpJI2VAdrvQi1D580pky.png)

　ユーザーIDとパスワードで新規登録する。

![](/2019-11-28/kJhLvv2dNo8RbtmKGIRkSrYB.png)

　登録されたアカウントは24時間しか有効ではない。  
　アカウント作成後、以下の画面に遷移する。

![](/2019-11-28/IUvT4a8cQUa07botCbdhU8q3.png)

　赤枠で囲われているアラートは、「アカウントは作成したが安全ではないので、以下の登録を行うように」と書かれている。項目は５つある。

- Security Keys  
- Internal (Built-in) Authenticators  
- Yubico One-Time Password  
- Authenticator applocation  
- Recovery Codes  

![](/2019-11-28/FxL6OQQiII9n8o1btLRQwnmP.png)

　セキュリティキーの登録を行ってみる。

![](/2019-11-28/cNGsEpEpAdizBZAh0na20dJz.png)

![](/2019-11-28/KI6HvAZARwGHpJdidOrEgsJn.png)

![](/2019-11-28/6Dl6d0SKMLbzZwW7B46KrFhS.png)

　Enable passwordless login with this key にチェックを入れ、NEXTボタンを押す。
firefoxの出す警告が出るが了解する。鍵マークは光らない。

![](/2019-11-28/JtLAH5ljRRusVVI29uqY8t2A.png)

![](/2019-11-28/BVp6fFC5OOAVPxSISRuQgugq.png)

　このデバイスはFIDO2に対応していないの？それとも、パスワードレスは想定していない？んじゃ、なんで、こんな項目あるの？

![](/2019-11-28/c44JvjH6XYUQ8v6u9BLm4wIw.png)

　Enable passwordless login with this key にチェックを入れずに、NEXTボタンを押すと登録できた。

![](/2019-11-28/ZNNAljjcOPkXSHtxGHxwdboB.png)

　青鍵と名前を付けて、DONEボタンを押すと登録された。

![](/2019-11-28/NtNDyjk6APsF6MYB027SRn0w.png)

　赤背景で出ていた警告が黄色に変わっている。最低でも２つの鍵を登録するか、リカバリーコードを生成して保存しておくようにと書かれている。確かに紛失や盗難リスクを考えると当然の対処だろう。

![](/2019-11-28/saENw4DK8Rx2q9czZRWHbXUw.png)

　一度SIGNOUTして、再度ログインすると、ユーザーIDとパスワードによる認証の後にポップアップが表示されて、yubikeyが点滅する。鍵マークをさわるとログインできた。

　リカバリーコードを作成してみる。

![](/2019-11-28/iDM5ArgAEj3gT3o89yemuuDI.png)

　8文字づつの10ペアが生成された。

![](/2019-11-28/rQyXqw5HQJa0jdZ1xBinie7y.png)

　というわけで、動作していることが確認できた。

つづく

---
> オリジナル投稿：
> Yubikeyを導入してみる 4｜kinneko｜pixivFANBOX  
> <https://www.fanbox.cc/@kinneko/posts/675617>
